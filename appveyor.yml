image: Visual Studio 2015
environment:
  PATH: $(APPDATA)\npm;$(PATH)

install:
  - ps: Install-Product node 6.9.1
  - npm install typescript -global
  - npm install ts-node -global
  - npm install tfx-cli -global
  - npm install mocha -global
  - npm install mocha-appveyor-reporter -global
  - npm install nyc -global
  - choco install codecov
  - ps: Import-Module .\build\BuildFunctions.psm1

before_build:
  - ps: InitAll (GetTypeScriptTaskModules)

before_package:
  - ps: Package (GetTypeScriptTaskModules)

test_script:
  - ps: TestAll (GetTypeScriptTaskModules) "mocha-appveyor-reporter"

after_test:
  - ps: SendCoverage (GetTypeScriptTaskModules)

artifacts:
  - path: ./bin/*.vsix
    name: ExtensionPackage

deploy:
  - provider: GitHub
    artifact: /.*\.vsix/
    draft: false
    prerelease: true
    on:
      branch: master
      appveyor_repo_tag: true
